using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace Cheese_Miner
{
    struct Player
    {
        public string Name;
        public int X_Position;
        public int Y_Position;
        public int Score;
    }

    struct board
    {
        public bool cheese;
    }

    class Program
    {
        static int Array_Size = 4;
        static Player[] Players = new Player[Array_Size];


        //making 8 by 8 grid 
        static int Board_Size_Max = 8;
        static board[,] Grid = new board[Board_Size_Max, Board_Size_Max];



        // global variables  
        static List<string> Current_Position = new List<string>();
        static List<int> Same_Space_Players = new List<int>();
        static int Player_Number;
        static int Move_Player_Number;
        static bool End_Game = false;



        //Prosedures and functions

        //player stats
        static void ShowStatus()
        {
            Console.WriteLine("there are " + Player_Number + " players in the game");
            for (int i = 0; i < Player_Number; i++)
            {
                Console.WriteLine(Players[i].Name + " is on squaure " + "(" + Players[i].X_Position + "," + Players[i].Y_Position + ") and has " + Players[i].Score + " cheeses");
            }
        }


        static void Player_Movement(int Current_Player_Number, int Distance, char Direction)
        {
            Console.WriteLine("Moving " + Players[Current_Player_Number].Name);
            switch (Direction)
            {
                case 'N':
                    Players[Current_Player_Number].Y_Position = Players[Current_Player_Number].Y_Position - Distance;
                    if (Players[Current_Player_Number].Y_Position < 0)
                        Players[Current_Player_Number].Y_Position = Players[Current_Player_Number].Y_Position + Board_Size_Max;
                    break;

                case 'S':
                    Players[Current_Player_Number].Y_Position = Players[Current_Player_Number].Y_Position + Distance;
                    if (Players[Current_Player_Number].Y_Position > Board_Size_Max - 1)
                        Players[Current_Player_Number].Y_Position = Players[Current_Player_Number].Y_Position - Board_Size_Max;
                    break;

                case 'W':
                    Players[Current_Player_Number].X_Position = Players[Current_Player_Number].X_Position - Distance;
                    if (Players[Current_Player_Number].X_Position < 0)
                        Players[Current_Player_Number].X_Position = Players[Current_Player_Number].X_Position + Board_Size_Max;
                    break;

                case 'E':
                    Players[Current_Player_Number].X_Position = Players[Current_Player_Number].X_Position + Distance;
                    if (Players[Current_Player_Number].X_Position > Board_Size_Max - 1)
                        Players[Current_Player_Number].X_Position = Players[Current_Player_Number].X_Position - Board_Size_Max;
                    break;
            }
            Cheese_Detection(Current_Player_Number);
            Player_Detection(Current_Player_Number);
            Display_Board();
            clear_all_same_player();
            Console.Clear();
        }

        static void Cheese_Detection(int Current_Player_Number)
        {
            if (Grid[Players[Current_Player_Number].X_Position, Players[Current_Player_Number].Y_Position].cheese == true)
            {
                Grid[Players[Current_Player_Number].X_Position, Players[Current_Player_Number].Y_Position].cheese = false;
                Players[Current_Player_Number].Score = Players[Current_Player_Number].Score + 1;
            }
        }

        static void clear_all_same_player()
        {
            for (int i = 0; i < Same_Space_Players.Count; i++)
            {
                Same_Space_Players.RemoveAt(i);
            }
        }

        static void Player_Detection(int Current_Player_Number)
        {

            int i = 0;

            List<int> players_to_search = new List<int>();
            for (int x = 0; x < Player_Number; x++)
            {
                players_to_search.Add(x);
            }
            players_to_search.RemoveAt(Current_Player_Number);
            foreach (int j in players_to_search)
            {
                //    Console.WriteLine(players_to_search[j-1]);

                if (Players[Current_Player_Number].X_Position == Players[j].X_Position && Players[Current_Player_Number].Y_Position == Players[j].Y_Position)
                {
                    Same_Space_Players.Add(i);
                    i++;
                }


                Cheese_Steal_Multi(Current_Player_Number, Same_Space_Players);
            }

            foreach (int p in players_to_search)
                if (Same_Space_Players.Count == 1)
                {
                    Players[Current_Player_Number].Score++;
                    Players[Same_Space_Players[0]].Score--;
                    if (Players[Same_Space_Players[0]].Score < 0)
                    {
                        Players[Same_Space_Players[0]].Score = 0;
                    }
                    break;
                }
            for (i = 0; i < players_to_search.Count; i++)
            {
                players_to_search.RemoveAt(i);
            }
        }

        static void Cheese_Steal_Multi(int Current_Player_Number, List<int> Players_To_Search)
        {
            if (Same_Space_Players.Count == 2)
            {
                foreach (int j in Players_To_Search)
                    Console.WriteLine(Players[Same_Space_Players[j]].Name + "has " + Players[j].Score + " cheeses");
                Players[Current_Player_Number].Score++;
                Console.WriteLine("select a victim to steal cheese from");
                int Victim_Number = int.Parse(Console.ReadLine());
                switch (Victim_Number)
                {
                    case 1:
                        Players[Same_Space_Players[Victim_Number]].Score--;
                        break;

                    case 2:
                        Players[Same_Space_Players[Victim_Number]].Score--;
                        break;
                }
                if (Players[Same_Space_Players[Victim_Number]].Score < 0)
                {
                    Players[Same_Space_Players[Victim_Number]].Score = 0;
                }
            }
        }


        //random die
        static int Die_Throw_Random()
        {
            Random rnd_Die = new Random();
            int Die_Value = rnd_Die.Next(1, 7);
            return Die_Value;
        }


        static void RNG_Cheese(int Number_of_Cheese)
        {
            Random rng_Cheese = new Random();

            int Cheese_X_Position = rng_Cheese.Next(0, Board_Size_Max);
            int Cheese_Y_Position = rng_Cheese.Next(0, Board_Size_Max);
            int i = 0;
            do
            {


                if ((Grid[Cheese_X_Position, Cheese_Y_Position].cheese == true) ||
            (Cheese_X_Position == 0 && Cheese_Y_Position == 0) ||
            (Cheese_X_Position == 0 && Cheese_Y_Position == Board_Size_Max - 1) ||
            (Cheese_X_Position == Board_Size_Max - 1 && Cheese_Y_Position == 0) ||
                       (Cheese_X_Position == Board_Size_Max - 1 && Cheese_Y_Position == Board_Size_Max - 1))
                {
                    Cheese_X_Position = rng_Cheese.Next(0, Board_Size_Max);
                    Cheese_Y_Position = rng_Cheese.Next(0, Board_Size_Max);
                    continue;
                }
                else
                {
                    Grid[Cheese_X_Position, Cheese_Y_Position].cheese = true;
                    i++;
                    Cheese_X_Position = rng_Cheese.Next(0, Board_Size_Max);
                    Cheese_Y_Position = rng_Cheese.Next(0, Board_Size_Max);

                }
            } while (i < Number_of_Cheese);

        }
        static void Cheese_Imput()
        {
            //int Cheese_Limit = 4 * Player_Number;
            int Cheese_Limit = 16;
            int Cheese_Number = 0;

            int Cheese_X_Position;
            int Cheese_Y_Position;

            //Imputs cheese to the Grid  
            do
            {

                for (int i = 0; i < Player_Number + 1; i++)
                {

                    if (i < Player_Number)
                    {
                        Console.WriteLine(" " + Players[i].Name + "  pick a X co-ordienet for the cheese ");
                        string Cheese_X_Position_string = Console.ReadLine();
                        Cheese_X_Position = Data_Check_int(Board_Size_Max - 1, 0, Cheese_X_Position_string);

                        Console.WriteLine(" " + Players[i].Name + "  pick a Y co-ordienet for the cheese ");
                        string Cheese_Y_Position_string = Console.ReadLine();
                        Cheese_Y_Position = Data_Check_int(Board_Size_Max - 1, 0, Cheese_Y_Position_string);

                        if ((Grid[Cheese_X_Position, Cheese_Y_Position].cheese == true) ||
                            (Cheese_X_Position == 0 && Cheese_Y_Position == 0) ||
                            (Cheese_X_Position == 0 && Cheese_Y_Position == Board_Size_Max - 1) ||
                            (Cheese_X_Position == Board_Size_Max - 1 && Cheese_Y_Position == 0) ||
                            (Cheese_X_Position == Board_Size_Max - 1 && Cheese_Y_Position == Board_Size_Max - 1))
                        {
                            do
                            {
                                Console.WriteLine("you have enterd a space that alredy has a cheese or a player is in that space in try another  ");
                                Console.WriteLine(" " + Players[i].Name + "  pick a X co-ordienet for the cheese ");
                                Cheese_X_Position = int.Parse(Console.ReadLine());
                                Console.WriteLine(" " + Players[i].Name + "  pick a Y co-ordienet for the cheese ");
                                Cheese_Y_Position = int.Parse(Console.ReadLine());
                                //change
                            } while (Grid[Cheese_X_Position, Cheese_Y_Position].cheese == true);
                        }

                        else if (Grid[Cheese_X_Position, Cheese_Y_Position].cheese == false)
                        {
                            Grid[Cheese_X_Position, Cheese_Y_Position].cheese = true;
                            Cheese_Number++;
                        }

                    }
                    else
                    {
                        i = 0;
                        break;
                    }

                }

            } while (Cheese_Number + 1 < Cheese_Limit);
        }


        static void Move_Number_Name_Conversion(string Move_Name)
        {
            for (int j = 0; j < Player_Number; j++)
            {

                if (Players[j].Name == Move_Name)
                {
                    Move_Player_Number = j;
                }
            }

        }
        static void Clear_Grid()
        {
            for (int i = 0; i < Board_Size_Max - 1; i++)
            {
                for (int j = 0; j < Board_Size_Max - 1; j++)
                {
                    Grid[i, j].cheese = false;
                }
            }
        }

        static void Win_Conditon()
        {
            for (int i = 0; i < Player_Number; i++)
            {
                if (Players[i].Score == 6)
                {
                    Console.WriteLine(Players[i].Name + " WINS!!!");
                    End_Game = true;
                }

            }
        }
        // board display
        static void Display_Board()
        {
            int i;
            int j;
            for (i = 0; i < Board_Size_Max; i++)
            {
                for (j = 0; j < Board_Size_Max; j++)
                {

                    
                        if ((i == Players[k].X_Position) &&
                            (j == Players[k].Y_Position))
                        {
                            Console.Write(Players[k].Name);

                        }
                    
                    {

                        if (Grid[i, j].cheese == true)
                        {
                            Console.Write(" C");
                        }
                        else if (Grid[i, j].cheese == false)
                        {
                            Console.Write(" X");
                        }


                        //Console.Write("\n");
                    }
                   
                }
                Console.Write("\n");
            }
        }


        // IDIOT PROOF COAD
        static int Data_Check_int(int Max_Check, int Min_Check, string Data_Check_Sring)
        {
            do
            {
                try
                {
                    int Data_Check_Number = int.Parse(Data_Check_Sring);
                    if (Data_Check_Number > Max_Check)
                    {
                        Console.WriteLine("Number is too high enter again");
                        Data_Check_Sring = Console.ReadLine();
                        continue;
                    }

                    if (Data_Check_Number < Min_Check)
                    {
                        Console.WriteLine("Number is too low enter again");
                        Data_Check_Sring = Console.ReadLine();
                        continue;
                    }
                    else
                    {
                        return Data_Check_Number;
                    }
                }
                catch
                {
                    Console.WriteLine("Value must be a number between " + Max_Check + " and " + Min_Check);
                    Data_Check_Sring = Console.ReadLine();
                    continue;
                }
            } while (true);
        }

        static void Data_Check_Player_Name(string Name_Imput)
        {
            for (int i = 0; i < Player_Number; i++)
            {
                if (Name_Imput.ToLower() == Players[i].Name.ToLower())
                {
                    break;
                }

                else if (Name_Imput != Players[i].Name)
                {
                    Console.WriteLine("You have enterd an invalid name please input a valid name");
                    Name_Imput = Console.ReadLine();
                    continue;
                }

            }
        }

        static char Data_Check_Char(string Char_Imput_String)
        {

            do
            {
                try
                {
                    char Char_Imput = char.Parse(Char_Imput_String);
                    Char_Imput = Char.ToUpper(Char_Imput);

                    if ((Char_Imput == 'N') ||
                        (Char_Imput == 'E') ||
                        (Char_Imput == 'W') ||
                        (char.ToUpper(Char_Imput) == 'S'))
                    {

                        return Char_Imput;
                    }

                    else if ((Char_Imput != 'N') ||
                             (Char_Imput != 'E') ||
                             (Char_Imput != 'W') ||
                             (Char_Imput != 'S'))
                    {
                        Console.WriteLine("You have enterd an invalid Direction please input a valid name");
                        Char_Imput = char.Parse(Console.ReadLine());
                        continue;
                    }
                }
                catch
                {
                    Console.WriteLine(" please enter a char ");
                    Char_Imput_String = Console.ReadLine();
                    continue;
                }

            } while (true);
        }

        static char User_Mode_Data_Check(string Promt)
        {
            do
            {

                Console.WriteLine(Promt);
                try
                {
                    char User_Imput = char.Parse(Console.ReadLine());
                    User_Imput = char.ToUpper(User_Imput);
                    Console.Clear();
                    if (User_Imput == 'Y' || User_Imput == 'N')
                    {
                        return User_Imput;
                    }
                    else
                    {
                        continue;
                    }
                }

                catch
                {
                    continue;
                }

            } while (true);

        }

        static void Main(string[] args)
        {
            string Test_Prompt = "Test Mode Y or N";
            char Test_Mode = User_Mode_Data_Check(Test_Prompt);
            
           

            Console.Clear();
            Console.WriteLine("Enter the amount of Players");
            string Player_Number_String = Console.ReadLine();
            Player_Number = Data_Check_int(4, 2, Player_Number_String);
            Console.Clear();
            //adding names and setting scores to 0 
            for (int i = 0; i < Player_Number; i++)
            {
                int Display_Num = i + 1;
                Console.WriteLine("Enter the name of Player " + Display_Num);
                Players[i].Name = Console.ReadLine();
                  Console.Clear();
                Players[i].Score = 0;
            }
            // setting inital positions in the grid 
            // delibertly left these as numbers cause helps with debugging 
            Players[0].X_Position = 0;
            Players[0].Y_Position = 0;

            Players[1].X_Position = 0;
            Players[1].Y_Position = 7;

            Players[2].X_Position = 7;
            Players[2].Y_Position = 0;

            Players[3].X_Position = 7;
            Players[3].Y_Position = 7;

            for (int i = 0; i < Player_Number; i++)
            {
                Current_Position.Add(Players[i].X_Position.ToString() + Players[i].Y_Position.ToString());
            }

            Clear_Grid();
            string Cheese_Prompt = "Do you want to auto place cheese";
            char Cheese_Auto = User_Mode_Data_Check(Cheese_Prompt);
            if (Cheese_Auto == 'N')
            {
                Cheese_Imput();
            }
            else
            {
                int Cheese_Max = 16;
                RNG_Cheese(Cheese_Max);
            }

            if (Test_Mode == 'N')
            {
                do
                {
                    for (int i = 0; i < Player_Number; i++)
                    {
                        Console.WriteLine("enter your players Name ");
                        string Move_Number_String = Console.ReadLine();
                        Data_Check_Player_Name(Move_Number_String);
                        Move_Number_Name_Conversion(Move_Number_String);

                        int Move_Die_roll = Die_Throw_Random();
                        Console.WriteLine(Move_Number_String + "rolled a " + Move_Die_roll);

                        Display_Board();

                        Console.WriteLine("enter your player direction ");
                        string Move_Direction_String = Console.ReadLine();
                        char Move_Direction = Data_Check_Char(Move_Direction_String);


                        Player_Movement(Move_Player_Number, Move_Die_roll, Move_Direction);

                        ShowStatus();
                        Win_Conditon();
                    }
                } while (End_Game == false);
            }

            if (Test_Mode == 'Y')
            {
                do
                {
                    Display_Board();
                    for (int i = 0; i < Player_Number; i++)
                    {
                        Console.WriteLine("enter your players Name ");
                        string Move_Number_String = Console.ReadLine();
                        Data_Check_Player_Name(Move_Number_String);
                        Move_Number_Name_Conversion(Move_Number_String);


                        Console.WriteLine("enter your player direction ");
                        string Move_Direction_String = Console.ReadLine();
                        char Move_Direction = Data_Check_Char(Move_Direction_String);

                        Console.WriteLine("enter your players Die roll ");
                        string Move_Die_roll = Console.ReadLine();


                        Player_Movement(Move_Player_Number, Data_Check_int(6, 1, Move_Die_roll), Move_Direction);
                        ShowStatus();
                        Win_Conditon();
                    }

                    //Player_Movement(0, 2, 'e');
                } while (End_Game == false);
            }
            ShowStatus();
            Console.ReadLine();
        }
    }
    /* 
   test doc
   https://github.com/ll01/Cheese_Miner.git
   warp
   */
}
